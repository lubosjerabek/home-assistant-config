leave_home:
  sequence:
    - service: automation.turn_off
      entity_id:
        - automation.bathroom_light_on
        - automation.cupboard_light_on
        - automation.gateway_light_on
        - automation.kitchen_lights_on
        - automation.turn_on_speaker_when_chromecast_is_playing
        - automation.turn_on_speaker_when_kodi_is_playing
        - automation.heating_on_every_morning
    - service: automation.turn_on
      entity_id:
        - automation.hall_light_on_when_door_opens
        - automation.hall_light_off_after_door_closes
        - automation.purifiers_off_when_cleanup_done
        - automation.notify_when_door_opens
    - service: script.set_heating
      data:
        mode: away
        temperature: 18
    - service: light.turn_off
      data:
        entity_id:
          - group.kitchen_lights
          - group.living_room_lights
          - group.other_lights
    - service: media_player.turn_off
      entity_id:
        - media_player.kodi
        - media_player.living_room_tv
        - media_player.tv_speaker
        - media_player.bedroom_speaker
        - media_player.kitchen_speaker
        - media_player.printer_speaker
        - media_player.desk_speaker
    - service: fan.turn_on
      data:
        entity_id: group.purifiers
    - service: vacuum.set_fan_speed
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        fan_speed: turbo
    - service: vacuum.start
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner

back_home:
  sequence:
    - service: script.set_heating
      data:
        mode: none
        temperature: 21
    - service: automation.turn_on
      entity_id:
        - automation.bathroom_light_on
        - automation.cupboard_light_on
        - automation.gateway_light_on
        - automation.kitchen_lights_on
        - automation.turn_on_speaker_when_chromecast_is_playing
        - automation.turn_on_speaker_when_kodi_is_playing
        - automation.heating_on_every_morning
    - service: automation.turn_off
      entity_id:
        - automation.purifiers_off_when_cleanup_done
        - automation.notify_when_door_opens
    - service: vacuum.set_fan_speed
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        fan_speed: medium
    - service: vacuum.return_to_base
      entity_id:
        - vacuum.xiaomi_vacuum_cleaner
    - service: kodi.call_method
      data:
        entity_id: media_player.kodi
        method: VideoLibrary.Scan
    - service: fan.set_speed
      data:
        entity_id: group.purifiers
        speed: auto
    - service: media_player.play_media
      data:
        entity_id: media_player.kitchen_speaker
        media_content_id: 'https://jerab.in/media/play_music.mp3'
        media_content_type: music

notify_presence:
  sequence:
    service: notify.notify
    data_template:
      title: Home Assistant
      message: >
        {% set name = states[entityid.split('.')[0]][entityid.split('.')[1]].name %}
        {% if tostate == 'not_home' %}
          {{-name }} left {{fromstate}}
        {% elif fromstate == 'not_home' %}
          {{-name }} arrived at {{tostate}}
        {% else %}
          {{-name }} left {{fromstate}} and arrived at {{tostate}}
        {% endif %}

set_heating:
  sequence:
    - service: climate.set_preset_mode
      data:
        entity_id: climate.lounge_temperature
        preset_mode: "{{ mode }}"
    - service: climate.set_temperature
      data_template:
        entity_id: climate.lounge_temperature
        temperature: "{{ temperature }}"

vacuum_bedroom:
  sequence:
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_zoned_clean
        params: [[20650,23230,24100,26480,1]]

vacuum_living_room:
  sequence:
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_zoned_clean
        params: [[24230,23380,28630,25980,1]]

vacuum_kitchen:
  sequence:
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_zoned_clean
        params: [[25700,26100,28100,27800,1]]

vacuum_bathroom:
  sequence:
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_zoned_clean
        params: [[21420,27680,22370,29880,1]]

vacuum_hall:
  sequence:
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_zoned_clean
        params: [[22610,26580,24960,28430,1]]
