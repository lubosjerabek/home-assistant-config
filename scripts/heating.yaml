set_thermostat:
  sequence:
    - condition: state
      entity_id: input_boolean.heating
      state: "on"
    - service: climate.set_preset_mode
      data:
        entity_id: "{{ entity_id }}"
        preset_mode: home
    - service: climate.set_temperature
      data_template:
        entity_id: "{{ entity_id }}"
        temperature: "{{ temperature | float }}"

increase_temperature:
  sequence:
    - condition: template
      value_template: >
        {% set set_temperature = state_attr(entity_id, "temperature") %}
        {{ is_state(entity_id, "off") or temperature > set_temperature }}
    - service: script.set_thermostat
      data:
        entity_id: "{{ entity_id }}"
        temperature: "{{ temperature }}"

heating_away:
  sequence:
    - service: climate.turn_off
      entity_id:
          - climate.kitchen
          - climate.bedroom
          - climate.office
          - climate.loft
          - climate.kids_room
    - service: switch.turn_off
      entity_id:
          - switch.schedule_living_room_heating_non_workday
          - switch.schedule_living_room_heating_workday
          - switch.schedule_kids_room_heating_non_workday
          - switch.schedule_kids_room_heating_workday
          - switch.schedule_bedroom_heating
          - switch.schedule_kitchen_heating
          - switch.schedule_loft_heating
          - switch.schedule_office_heating
    - condition: state
      entity_id: input_boolean.heating
      state: "on"
    - service: climate.set_preset_mode
      data:
        entity_id: climate.living_room
        preset_mode: away
    - service: climate.set_temperature
      data_template:
        entity_id: climate.living_room
        temperature: "{{ states('input_number.default_away_temperature') }}"

heating_close:
  sequence:
    - service: switch.turn_on
      entity_id:
          - switch.schedule_living_room_heating_non_workday
          - switch.schedule_living_room_heating_workday
          - switch.schedule_kids_room_heating_non_workday
          - switch.schedule_kids_room_heating_workday
          - switch.schedule_bedroom_heating

heating_back:
  sequence:
    - service: switch.turn_on
      entity_id:
          - switch.schedule_living_room_heating_non_workday
          - switch.schedule_living_room_heating_workday
          - switch.schedule_kids_room_heating_non_workday
          - switch.schedule_kids_room_heating_workday
          - switch.schedule_bedroom_heating
          - switch.schedule_kitchen_heating
    - service: scheduler.run_action
      entity_id:
          - switch.schedule_living_room_heating_non_workday
          - switch.schedule_living_room_heating_workday
          - switch.schedule_kids_room_heating_non_workday
          - switch.schedule_kids_room_heating_workday
          - switch.schedule_bedroom_heating
          - switch.schedule_kitchen_heating
    - service: climate.set_preset_mode
      data:
        entity_id: climate.living_room
        preset_mode: home
    - if:
        - condition: state
          entity_id: input_boolean.guest_mode
          state: "on"
      then:
        - service: switch.turn_on
          entity_id: switch.schedule_loft_heating

boost_heating:
  mode: parallel
  sequence:
    - condition: template
      value_template: "{{ state_attr(zone, 'temperature') <= 21 }}"
    - service: script.increase_temperature
      data:
        entity_id: "{{ zone }}"
        temperature: "{{ state_attr(zone, 'temperature') + 1 }}"
    - delay: '00:30:00'
    - condition: template
      value_template: "{{ states(zone) == 'heat' }}"
    - service: script.set_thermostat
      data:
        entity_id: "{{ zone }}"
        temperature: "{{ state_attr(zone, 'temperature') - 1 }}"

boost_bedroom_heating:
  sequence:
    - service: script.boost_heating
      data:
        zone: climate.bedroom

boost_kids_room_heating:
  sequence:
    - service: script.boost_heating
      data:
        zone: climate.kids_room

boost_office_heating:
  sequence:
    - service: script.boost_heating
      data:
        zone: climate.office

boost_loft_heating:
  sequence:
    - service: script.boost_heating
      data:
        zone: climate.loft
